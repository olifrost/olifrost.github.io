---
// BioBuilder.astro - Interactive bio building component
---

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8" id="bio-builder">
    <!-- Photo section -->
    <div class="lg:col-span-1">
        <div class="sticky top-8">
            <!-- Photo carousel -->
            <div class="relative mb-4">
                <div id="photo-carousel" class="overflow-hidden rounded-lg shadow-md">
                    <div class="flex transition-transform duration-300 ease-in-out" id="carousel-track">
                        <img src="/img/olifrost.jpg" alt="Oli Frost - Headshot 1" class="w-full flex-shrink-0">
                        <img src="/img/olifrost-full.jpg" alt="Oli Frost - Full body" class="w-full flex-shrink-0">
                        <img src="/img/olifrost-carrot.jpg" alt="Oli Frost - With carrot" class="w-full flex-shrink-0">
                    </div>
                </div>
                
                <!-- Carousel controls -->
                <div class="flex justify-center mt-2 space-x-2">
                    <button class="carousel-dot w-2 h-2 rounded-full bg-blue-600" data-slide="0"></button>
                    <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300" data-slide="1"></button>
                    <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300" data-slide="2"></button>
                </div>
            </div>
            
            <a 
                id="download-photo"
                href="/img/olifrost.jpg" 
                download="oli-frost-headshot.jpg"
                class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors mb-4"
            >
                Download Photo
            </a>
            
            <!-- Controls -->
            <div class="space-y-2">
                <button 
                    id="copy-bio" 
                    class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded transition-colors"
                >
                    Copy Bio
                </button>
                <button 
                    id="reset-bio" 
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-colors"
                >
                    Reset
                </button>
            </div>
            
            <p class="text-sm text-gray-600 mt-4 text-center">
                High-res photos coming soon
            </p>
        </div>
    </div>

    <!-- Bio output section -->
    <div class="lg:col-span-2">
        <div class="bg-gray-50 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-semibold mb-4">Your Bio <span class="text-sm font-normal text-gray-600">(click blue text to edit)</span></h2>
            
            <div id="bio-output" class="prose prose-lg max-w-none leading-relaxed space-y-4 text-gray-900">
                <p>
                    Oli Frost <span class="bio-variable" data-type="intro">makes songs, films and websites about the climate crisis</span>. 
                    He <span class="bio-variable" data-type="achievement1">got Greta Thunberg dancing the macarena</span>, <span class="bio-variable" data-type="achievement2">created a fossil fuel funfair</span>, and <span class="bio-variable" data-type="achievement3">made a video game about asset management</span>.
                </p>
                
                <p id="coverage-paragraph" class="hidden">
                    His work has been featured <span class="bio-variable" data-type="coverage">everywhere from UK Parliament to Britain's Got Talent, BBC to Fox News</span>.
                </p>
                
                <p id="work-paragraph" class="hidden">
                    <span class="bio-variable" data-type="collaboration">He works with Greenpeace and co-founded climate campaign group Serious People</span>. 
                    <span class="bio-variable" data-type="stats">His content has 330k followers and over 75 million views</span>.
                </p>
            </div>
        </div>

        <!-- Options panel (appears when clicking variables) -->
        <div id="options-panel" class="hidden bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50">
            <h3 id="options-title" class="font-semibold mb-3 text-gray-800"></h3>
            <div id="options-content" class="space-y-1 max-h-80 overflow-y-auto"></div>
            <button id="close-options" class="mt-3 text-sm text-gray-500 hover:text-gray-700">Close</button>
        </div>
    </div>
</div>

<script>
    // Bio options data
    const bioOptions: Record<string, string[]> = {
        intro: [
            "makes songs, films and websites about the climate crisis",
            "is a climate satirist and online creator",
            "is a musician, filmmaker and digital artist",
            "is a total nobody"
        ],
        achievement1: [
            "got Greta Thunberg dancing the macarena",
            "created a fossil fuel funfair",
            "made a video game about asset management",
            "sold all his personal data on eBay",
            "played the recorder for Simon Cowell",
            "took a shellphone to the UN Ocean Conference",
            "delivered a tiny violin to Shell executives",
            "played recorder on Britain's Got Talent",
            "created a viral song about socialist vampires",
            "made a wellness app for oil executives",
            "organised a climate strike for baby penguins in Antarctica",
            "created a series of viral climate strike posters",
            "was president of his university's bongo society (unverified)"
        ],
        achievement2: [
            "created a fossil fuel funfair",
            "made a video game about asset management",
            "sold all his personal data on eBay",
            "played the recorder for Simon Cowell",
            "got Greta Thunberg dancing the macarena",
            "took a shellphone to the UN Ocean Conference", 
            "delivered a tiny violin to Shell executives",
            "played recorder on Britain's Got Talent",
            "created a viral song about socialist vampires",
            "made a wellness app for oil executives",
            "organised a climate strike for baby penguins in Antarctica",
            "created a series of viral climate strike posters",
            "was president of his university's bongo society (unverified)"
        ],
        achievement3: [
            "made a video game about asset management",
            "sold all his personal data on eBay",
            "played the recorder for Simon Cowell",
            "got Greta Thunberg dancing the macarena",
            "created a fossil fuel funfair",
            "took a shellphone to the UN Ocean Conference",
            "delivered a tiny violin to Shell executives", 
            "played recorder on Britain's Got Talent",
            "created a viral song about socialist vampires",
            "made a wellness app for oil executives",
            "organised a climate strike for baby penguins in Antarctica",
            "created a series of viral climate strike posters",
            "was president of his university's bongo society (unverified)"
        ],
        coverage: [
            "everywhere from UK Parliament to Britain's Got Talent, BBC to Fox News",
            "was recently featured in Financial Times", 
            "from Parliament to music festivals, art shows to bins",
            "by major news outlets and climate organizations worldwide"
        ],
        collaboration: [
            "He works with Greenpeace and co-founded climate campaign group Serious People",
            "He co-founded climate campaign studio Serious People",
        ],
        stats: [
            "His content has 330k followers and over 75 million views",
            "Only 1 person has recognized him in Franco Manca (but he was wearing a hat)",
            "His work has a complex psychological relationship with numbers"
        ]
    };

    // Carousel functionality
    let currentSlide = 0;
    const slides = document.querySelectorAll('#bio-builder #carousel-track img');
    const dots = document.querySelectorAll('#bio-builder .carousel-dot');
    const track = document.querySelector('#bio-builder #carousel-track') as HTMLElement;
    const downloadLink = document.querySelector('#bio-builder #download-photo') as HTMLAnchorElement;
    
    const photos = [
        { src: '/img/olifrost.jpg', filename: 'oli-frost-headshot.jpg' },
        { src: '/img/olifrost-full.jpg', filename: 'oli-frost-full.jpg' },
        { src: '/img/olifrost-carrot.jpg', filename: 'oli-frost-carrot.jpg' }
    ];

    function updateCarousel() {
        if (track) {
            track.style.transform = `translateX(-${currentSlide * 100}%)`;
        }
        dots.forEach((dot, index) => {
            dot.classList.toggle('bg-blue-600', index === currentSlide);
            dot.classList.toggle('bg-gray-300', index !== currentSlide);
        });
        
        // Update download link
        if (downloadLink && photos[currentSlide]) {
            downloadLink.href = photos[currentSlide].src;
            downloadLink.download = photos[currentSlide].filename;
        }
    }

    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            currentSlide = index;
            updateCarousel();
        });
    });

    // Bio variable click handling
    let currentOptionsPanel: HTMLElement | null = null;

    function showOptions(type: string, element: HTMLElement) {
        const panel = document.querySelector('#bio-builder #options-panel') as HTMLElement;
        const title = document.querySelector('#bio-builder #options-title') as HTMLElement;
        const content = document.querySelector('#bio-builder #options-content') as HTMLElement;
        
        if (!panel || !title || !content) return;
        
        currentOptionsPanel = element;
        
        // Set title
        const titles: Record<string, string> = {
            intro: 'Choose introduction style:',
            achievement1: 'Choose first achievement:',
            achievement2: 'Choose second achievement:',
            achievement3: 'Choose third achievement:',
            coverage: 'Choose press coverage:',
            collaboration: 'Choose collaboration style:',
            stats: 'Choose stats:'
        };
        title.textContent = titles[type] || `Choose ${type}:`;
        
        // Clear and populate content
        content.innerHTML = '';
        
        bioOptions[type]?.forEach((option: string) => {
            const button = document.createElement('button');
            button.textContent = option;
            button.className = 'block w-full text-left p-3 hover:bg-blue-50 rounded transition-colors text-sm border border-transparent hover:border-blue-200';
            button.addEventListener('click', () => {
                if (currentOptionsPanel) {
                    currentOptionsPanel.textContent = option;
                }
                panel.classList.add('hidden');
            });
            content.appendChild(button);
        });
        
        // Position and show panel
        panel.classList.remove('hidden');
        panel.style.position = 'absolute';
        
        // Position below the clicked element
        const rect = element.getBoundingClientRect();
        const containerRect = element.closest('.lg\\:col-span-2')?.getBoundingClientRect();
        if (containerRect) {
            panel.style.top = `${rect.bottom - containerRect.top + 10}px`;
            panel.style.left = `${rect.left - containerRect.left}px`;
            panel.style.maxWidth = '400px';
        }
    }

    // Add click handlers to bio variables (scoped to bio-builder)
    document.querySelectorAll('#bio-builder .bio-variable').forEach(variable => {
        variable.addEventListener('click', (e) => {
            const target = e.target as HTMLElement;
            if (target) {
                const type = target.getAttribute('data-type');
                if (type) {
                    showOptions(type, target);
                }
            }
        });
    });

    // Close options panel
    document.querySelector('#bio-builder #close-options')?.addEventListener('click', () => {
        document.querySelector('#bio-builder #options-panel')?.classList.add('hidden');
    });

    // Hide options panel when clicking outside (scoped to bio-builder)
    document.addEventListener('click', (e) => {
        const panel = document.querySelector('#bio-builder #options-panel') as HTMLElement;
        const target = e.target as Element;
        if (panel && 
            !target.closest('#bio-builder .bio-variable') && 
            !target.closest('#bio-builder #options-panel')) {
            panel.classList.add('hidden');
        }
    });

    // Copy bio functionality
    document.querySelector('#bio-builder #copy-bio')?.addEventListener('click', () => {
        const bioOutput = document.querySelector('#bio-builder #bio-output') as HTMLElement;
        if (bioOutput) {
            const bioText = bioOutput.textContent?.trim() || '';
            navigator.clipboard.writeText(bioText).then(() => {
                const button = document.querySelector('#bio-builder #copy-bio') as HTMLButtonElement;
                if (button) {
                    const originalText = button.textContent;
                    button.textContent = 'Copied!';
                    button.className = button.className.replace('bg-green-600 hover:bg-green-700', 'bg-green-800');
                    
                    setTimeout(() => {
                        if (button && originalText) {
                            button.textContent = originalText;
                            button.className = button.className.replace('bg-green-800', 'bg-green-600 hover:bg-green-700');
                        }
                    }, 2000);
                }
            });
        }
    });

    // Reset functionality
    document.querySelector('#bio-builder #reset-bio')?.addEventListener('click', () => {
        // Reset to default values
        const defaults: Record<string, string> = {
            intro: "makes songs, films and websites about the climate crisis",
            achievement1: "got Greta Thunberg dancing the macarena",
            achievement2: "created a fossil fuel funfair",
            achievement3: "made a video game about asset management",
            coverage: "everywhere from UK Parliament to Britain's Got Talent, BBC to Fox News",
            collaboration: "He works with Greenpeace and co-founded climate campaign group Serious People",
            stats: "His content has 330k followers and over 75 million views"
        };
        
        Object.entries(defaults).forEach(([type, text]) => {
            const element = document.querySelector(`#bio-builder [data-type="${type}"]`) as HTMLElement;
            if (element) {
                element.textContent = text;
            }
        });
        
        // Hide options panel
        document.querySelector('#bio-builder #options-panel')?.classList.add('hidden');
    });
</script>

<style>
    /* Shortcuts-style variable styling */
    #bio-builder .bio-variable {
        background-color: rgb(219 234 254); /* bg-blue-100 */
        color: rgb(37 99 235); /* text-blue-600 */
        padding: 2px 6px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
        border: 1px solid rgb(191 219 254); /* border-blue-200 */
    }
    
    #bio-builder .bio-variable:hover {
        background-color: rgb(191 219 254); /* bg-blue-200 */
        color: rgb(29 78 216); /* text-blue-700 */
        border-color: rgb(147 197 253); /* border-blue-300 */
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #bio-builder .prose p {
        margin-bottom: 0;
    }
    
    #bio-builder #options-panel {
        position: relative;
    }
</style>
