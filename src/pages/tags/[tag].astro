---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
import { getCollection } from 'astro:content';
import ProjectSummary from '../../components/ProjectSummary.astro';

export async function getStaticPaths() {
  const allProjects = await getCollection('blog');
  
  // Extract all tags from all projects
  const uniqueTags = [...new Set(
    allProjects.flatMap(project => project.data.tags || [])
  )];
  
  // Create a path for each tag
  return uniqueTags.map(tag => ({
    params: { tag },
    props: { 
      tag,
      projects: allProjects.filter(project => 
        project.data.tags?.includes(tag)
      ).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    }
  }));
}

const { tag, projects } = Astro.props;

// Format the tag for display (capitalize, replace hyphens with spaces, etc.)
const formattedTag = tag
  .split('-')
  .map(word => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`${formattedTag} - ${SITE_TITLE}`} description={`Browse all ${formattedTag.toLowerCase()} projects by Oli Frost`} />
	</head>
	<body class="bg-white">
		<Header />
		<main class="max-w-5xl mx-auto px-4 py-8">
			<div class="mb-12">
				<h1 class="text-3xl font-bold mb-4 text-black">{formattedTag}</h1>
				<p class="">
					Showing {projects.length} project{projects.length !== 1 ? 's' : ''} tagged with "{formattedTag.toLowerCase()}"
				</p>
			</div>
			
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{projects.map((project) => (
					<ProjectSummary project={project} />
				))}
			</div>
		</main>
		<Footer />
	</body>
</html>